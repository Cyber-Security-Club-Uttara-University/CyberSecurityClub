<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificate Positioning Panel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Geometos:wght@400;700&display=swap');
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .control-group label {
            font-weight: bold;
            font-size: 12px;
        }
        .control-group input, .control-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn:hover {
            background: #5a67d8;
        }
        .btn-small {
            background: #667eea;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-top: 5px;
        }
        .btn-small:hover {
            background: #5a67d8;
        }
        .btn-small:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
        .preview-container {
            position: relative;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            background: #f9f9f9;
            margin-top: 20px;
        }
        .preview-canvas {
            max-width: 100%;
            display: block;
        }
        .coordinates {
            background: #e2e8f0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: monospace;
        }
        .info {
            background: #bee3f8;
            border-left: 4px solid #3182ce;
            padding: 10px 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Certificate Positioning Panel</h1>
        <p>This tool helps you find the exact position for student names on your certificate template.</p>
        
        <div class="info">
            <strong>Instructions:</strong>
            <ol>
                <li><strong>Certificate.png</strong> is automatically loaded by default. You can upload a different template if needed.</li>
                <li>Adjust the position sliders to place the name where <strong>{{STUDENT_NAME}}</strong> should appear</li>
                <li>Copy the generated coordinates to your certificate-generator.js file</li>
            </ol>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>Template Image:</label>
                <input type="file" id="templateFile" accept="image/*">
            </div>
            
            <div class="control-group">
                <label>Student Name:</label>
                <input type="text" id="studentName" value="Pranto Kumar Shil" placeholder="Test name">
            </div>
            
            <div class="control-group">
                <label>Horizontal Position (%):</label>
                <input type="range" id="nameX" min="0" max="100" value="50" step="1">
                <span id="nameXValue">50%</span>
            </div>
            
            <div class="control-group">
                <label>Vertical Position (%):</label>
                <input type="range" id="nameY" min="0" max="100" value="48" step="1">
                <span id="nameYValue">48%</span>
            </div>
            
            <div class="control-group">
                <label>Font Size (px):</label>
                <input type="range" id="fontSize" min="20" max="800" value="180" step="5">
                <span id="fontSizeValue">180px</span>
            </div>
            
            <div class="control-group">
                <label>Text Color:</label>
                <select id="textColor">
                    <option value="#000000">Black</option>
                    <option value="#FFFFFF">White</option>
                    <option value="#1A365D">Dark Blue</option>
                    <option value="#2D3748">Dark Gray</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Font Family:</label>
                <select id="fontFamily">
                    <option value="GEOMETOS">GEOMETOS (Current)</option>
                    <option value="Arial">Arial</option>
                    <option value="Helvetica">Helvetica</option>
                </select>
            </div>

            <div class="control-group">
                <label>Google Fonts:</label>
                <select id="googleFonts">
                    <option value="">Select Google Font...</option>
                </select>
                <button class="btn-small" onclick="loadGoogleFonts()">Load Google Fonts</button>
            </div>
            
            <div class="control-group">
                <label>Actions:</label>
                <button class="btn" onclick="updatePreview()">Update Preview</button>
            </div>
        </div>

        <div class="preview-container">
            <canvas id="previewCanvas" class="preview-canvas"></canvas>
        </div>

        <div class="coordinates">
            <strong>Copy this code to your certificate-generator.js:</strong><br><br>
            <div id="generatedCode">
                Load a template and adjust the position to generate code...
            </div>
        </div>
    </div>

    <script>
        let templateImage = null;
        let canvas = document.getElementById('previewCanvas');
        let ctx = canvas.getContext('2d');

        // Google Fonts list
        let googleFontsList = [];
        let loadedFonts = new Set();

        // Initialize controls
        document.getElementById('templateFile').addEventListener('change', loadTemplate);
        document.getElementById('nameX').addEventListener('input', updateSliderValues);
        document.getElementById('nameY').addEventListener('input', updateSliderValues);
        document.getElementById('fontSize').addEventListener('input', updateSliderValues);
        document.getElementById('studentName').addEventListener('input', updatePreview);
        document.getElementById('textColor').addEventListener('change', updatePreview);
        document.getElementById('fontFamily').addEventListener('change', updatePreview);
        document.getElementById('googleFonts').addEventListener('change', handleGoogleFontSelection);

        function updateSliderValues() {
            document.getElementById('nameXValue').textContent = document.getElementById('nameX').value + '%';
            document.getElementById('nameYValue').textContent = document.getElementById('nameY').value + '%';
            document.getElementById('fontSizeValue').textContent = document.getElementById('fontSize').value + 'px';
            updatePreview();
        }

        function loadTemplate(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                templateImage = new Image();
                templateImage.onload = function() {
                    // Set canvas size to match image
                    canvas.width = templateImage.width;
                    canvas.height = templateImage.height;
                    
                    // Scale canvas for display
                    const maxWidth = 800;
                    if (templateImage.width > maxWidth) {
                        const scale = maxWidth / templateImage.width;
                        canvas.style.width = maxWidth + 'px';
                        canvas.style.height = (templateImage.height * scale) + 'px';
                    }
                    
                    updatePreview();
                };
                templateImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function updatePreview() {
            if (!templateImage) {
                document.getElementById('generatedCode').textContent = 'Please load a template image first.';
                return;
            }

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw template
            ctx.drawImage(templateImage, 0, 0);
            
            // Get control values
            const nameX = parseFloat(document.getElementById('nameX').value) / 100;
            const nameY = parseFloat(document.getElementById('nameY').value) / 100;
            const fontSize = parseInt(document.getElementById('fontSize').value);
            const textColor = document.getElementById('textColor').value;
            const studentName = document.getElementById('studentName').value || 'Student Name';
            const selectedFont = getCurrentFont();
            
            // Calculate pixel positions
            const pixelX = canvas.width * nameX;
            const pixelY = canvas.height * nameY;
            
            // Configure text
            ctx.fillStyle = textColor;
            ctx.font = `bold ${fontSize}px ${selectedFont}, Arial, sans-serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Add text shadow for visibility
            ctx.shadowColor = textColor === '#FFFFFF' ? 'rgba(0,0,0,0.5)' : 'rgba(255,255,255,0.5)';
            ctx.shadowBlur = 2;
            ctx.shadowOffsetX = 1;
            ctx.shadowOffsetY = 1;
            
            // Draw name
            ctx.fillText(studentName, pixelX, pixelY);
            
            // Reset shadow
            ctx.shadowColor = 'transparent';
            
            // Generate code
            generateCode(nameX, nameY, fontSize, textColor, selectedFont);
        }

        function generateCode(nameX, nameY, fontSize, textColor, selectedFont) {
            selectedFont = selectedFont || getCurrentFont();
            const code = `// Update your addNameToCanvaTemplate function:
addNameToCanvaTemplate(ctx, studentName, width, height) {
    ctx.fillStyle = '${textColor}';
    ctx.font = 'bold ${fontSize}px ${selectedFont}, Arial, sans-serif';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';

    const nameX = width * ${nameX.toFixed(3)};
    const nameY = height * ${nameY.toFixed(3)};

    // Add text shadow for better visibility
    ctx.shadowColor = '${textColor === '#FFFFFF' ? 'rgba(0,0,0,0.3)' : 'rgba(255,255,255,0.8)'}';
    ctx.shadowBlur = 2;
    ctx.shadowOffsetX = 1;
    ctx.shadowOffsetY = 1;

    ctx.fillText(studentName, nameX, nameY);
    
    // Reset shadow
    ctx.shadowColor = 'transparent';
    ctx.shadowBlur = 0;
}

// Don't forget to load the font in your HTML head:
// <link href="https://fonts.googleapis.com/css2?family=${selectedFont.replace(' ', '+')}:wght@400;700&display=swap" rel="stylesheet">`;

            document.getElementById('generatedCode').textContent = code;
        }

        function getCurrentFont() {
            const googleFontSelect = document.getElementById('googleFonts');
            const regularFontSelect = document.getElementById('fontFamily');
            
            if (googleFontSelect.value && googleFontSelect.value !== '') {
                return googleFontSelect.value;
            }
            return regularFontSelect.value;
        }

        async function loadGoogleFonts() {
            const loadingBtn = event.target;
            const originalText = loadingBtn.textContent;
            loadingBtn.textContent = 'Loading...';
            loadingBtn.disabled = true;

            try {
                // Popular Google Fonts for certificates
                const popularFonts = [
                    'GEOMETOS', 'Playfair Display', 'Cormorant Garamond', 'Libre Baskerville',
                    'Crimson Text', 'Lora', 'Merriweather', 'PT Serif', 'Vollkorn',
                    'Cinzel', 'Tangerine', 'Dancing Script', 'Great Vibes', 'Pacifico',
                    'Montserrat', 'Open Sans', 'Roboto', 'Lato', 'Source Sans Pro',
                    'Oswald', 'Raleway', 'Ubuntu', 'Nunito', 'Poppins',
                    'Abril Fatface', 'Bangers', 'Fredoka One', 'Righteous', 'Kalam',
                    'Caveat', 'Amatic SC', 'Indie Flower', 'Shadows Into Light'
                ];

                const googleFontsSelect = document.getElementById('googleFonts');
                googleFontsSelect.innerHTML = '<option value="">Select Google Font...</option>';

                // Add fonts to dropdown
                popularFonts.forEach(font => {
                    const option = document.createElement('option');
                    option.value = font;
                    option.textContent = font;
                    googleFontsSelect.appendChild(option);
                });

                googleFontsList = popularFonts;
                loadingBtn.textContent = 'Fonts Loaded!';
                setTimeout(() => {
                    loadingBtn.textContent = originalText;
                    loadingBtn.disabled = false;
                }, 2000);

            } catch (error) {
                console.error('Error loading Google Fonts:', error);
                loadingBtn.textContent = 'Error Loading';
                setTimeout(() => {
                    loadingBtn.textContent = originalText;
                    loadingBtn.disabled = false;
                }, 2000);
            }
        }

        function handleGoogleFontSelection() {
            const selectedFont = document.getElementById('googleFonts').value;
            if (selectedFont && !loadedFonts.has(selectedFont)) {
                loadGoogleFont(selectedFont);
            }
            updatePreview();
        }

        function loadGoogleFont(fontName) {
            if (loadedFonts.has(fontName)) return;

            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = `https://fonts.googleapis.com/css2?family=${fontName.replace(/ /g, '+')}:wght@400;700&display=swap`;
            document.head.appendChild(link);
            
            loadedFonts.add(fontName);

            // Wait for font to load before updating preview
            setTimeout(() => {
                updatePreview();
            }, 1000);
        }

        // Preload Certificate.png by default
        function preloadDefaultTemplate() {
            templateImage = new Image();
            templateImage.crossOrigin = 'anonymous';
            templateImage.onload = function() {
                // Set canvas size to match image
                canvas.width = templateImage.width;
                canvas.height = templateImage.height;
                
                // Scale canvas for display
                const maxWidth = 800;
                if (templateImage.width > maxWidth) {
                    const scale = maxWidth / templateImage.width;
                    canvas.style.width = maxWidth + 'px';
                    canvas.style.height = (templateImage.height * scale) + 'px';
                }
                
                updatePreview();
                console.log('Default Certificate.png template loaded successfully');
            };
            
            templateImage.onerror = function() {
                console.log('Certificate.png not found, waiting for manual template upload');
                document.getElementById('generatedCode').textContent = 'Default Certificate.png not found. Please load a template using the file input above.';
            };
            
            // Load the default Certificate.png template
            templateImage.src = 'Certificate.png';
        }

        // Initialize slider values and preload default template
        updateSliderValues();
        preloadDefaultTemplate();
    </script>
</body>
</html>
